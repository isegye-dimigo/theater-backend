generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Media {
  id           Int          @id @default(autoincrement()) @db.UnsignedInt
  hash         String       @unique(map: "hash") @db.VarChar(128)
  userId       Int          @map("user_id") @db.UnsignedInt
  type         String       @db.VarChar(3)
  size         Int          @db.UnsignedInt
  width        Int          @db.UnsignedInt
  height       Int          @db.UnsignedInt
  aspectRatio  String       @map("aspect_ratio") @db.VarChar(16)
  isVideo      Boolean      @map("is_video") @db.Bit(1)
  duration     Float?
  frameRate    Float?       @map("frame_rate")
  bitRate      Int?         @map("bit_rate") @db.UnsignedInt
  channelCount Int?         @map("channel_count") @db.UnsignedTinyInt
  isDeleted    Boolean      @default(dbgenerated("(b'0')")) @map("is_deleted") @db.Bit(1)
  createdAt    DateTime     @default(now()) @map("created_at") @db.DateTime(0)
  mediaVideos  MediaVideo[]
  imageMovie   Movie?       @relation("movie.image_media_id,media.id")
  videoMovie   Movie?       @relation("movie.video_media_id,media.id")
  bannerUser   User?        @relation("user.banner_media_id,media.id")
  profileUser  User?        @relation("user.profile_media_id,media.id")

  @@index([userId], map: "media.user_id,user.id")
  @@map("media")
}

model MediaVideo {
  id           Int   @id @default(autoincrement()) @db.UnsignedInt
  mediaId      Int   @map("media_id") @db.UnsignedInt
  index        Int   @db.UnsignedInt
  size         Int   @db.UnsignedInt
  duration     Float
  frameRate    Float @map("frame_rate")
  videoBitRate Int   @map("video_bit_rate") @db.UnsignedInt
  sampleRate   Int   @map("sample_rate") @db.UnsignedInt
  audioBitRate Int   @map("audio_bit_rate") @db.UnsignedInt
  media        Media @relation(fields: [mediaId], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "media_video.media_id,media.id")

  @@unique([mediaId, index], map: "media_id, index")
  @@map("media_video")
}

model Movie {
  id              Int              @id @default(autoincrement()) @db.UnsignedInt
  userId          Int              @map("user_id") @db.UnsignedInt
  title           String           @db.VarChar(128)
  description     String           @db.VarChar(4096)
  videoMediaId    Int              @unique(map: "video_id") @map("video_media_id") @db.UnsignedInt
  imageMediaId    Int              @unique(map: "image_id") @map("image_media_id") @db.UnsignedInt
  isDeleted       Boolean          @default(dbgenerated("(b'0')")) @map("is_deleted") @db.Bit(1)
  createdAt       DateTime         @default(now()) @map("created_at") @db.DateTime(0)
  imageMedia      Media            @relation("movie.image_media_id,media.id", fields: [imageMediaId], references: [id], onUpdate: Restrict, map: "movie.image_media_id,media.id")
  user            User             @relation(fields: [userId], references: [id], onUpdate: Restrict, map: "movie.user_id,user.id")
  videoMedia      Media            @relation("movie.video_media_id,media.id", fields: [videoMediaId], references: [id], onUpdate: Restrict, map: "movie.video_media_id,media.id")
  movieComments   MovieComment[]
  movieLikes      MovieLike[]
  movieStars      MovieStar[]
  movieStatistics MovieStatistic[]
  reports         Report[]
  userHistories   UserHistory[]

  @@index([userId], map: "movie.user_id,user.id")
  @@map("movie")
}

model MovieComment {
  id        Int      @id @default(autoincrement()) @db.UnsignedInt
  movieId   Int      @map("movie_id") @db.UnsignedInt
  userId    Int      @map("user_id") @db.UnsignedInt
  time      Int      @db.UnsignedInt
  content   String   @db.VarChar(128)
  isDeleted Boolean  @default(dbgenerated("(b'0')")) @map("is_deleted") @db.Bit(1)
  createdAt DateTime @default(now()) @map("created_at") @db.DateTime(0)
  movie     Movie    @relation(fields: [movieId], references: [id], onUpdate: Restrict, map: "movie_comment.movie_id,movie.id")
  user      User     @relation(fields: [userId], references: [id], onUpdate: Restrict, map: "movie_comment.user_id,user.id")
  reports   Report[]

  @@index([movieId], map: "movie_comment.movie_id,movie.id")
  @@index([userId], map: "movie_comment.user_id,user.id")
  @@map("movie_comment")
}

model MovieLike {
  id        Int      @id @default(autoincrement()) @db.UnsignedInt
  movieId   Int      @map("movie_id") @db.UnsignedInt
  userId    Int      @map("user_id") @db.UnsignedInt
  createdAt DateTime @default(now()) @map("created_at") @db.DateTime(0)
  media     Movie    @relation(fields: [movieId], references: [id], onUpdate: Restrict, map: "movie_like.movie_id,movie.id")
  user      User     @relation(fields: [userId], references: [id], onUpdate: Restrict, map: "movie_like.user_id,user.id")

  @@unique([movieId, userId], map: "movie_id,user_id")
  @@index([userId], map: "movie_like.user_id,user.id")
  @@map("movie_like")
}

model MovieStar {
  id        Int      @id @default(autoincrement()) @db.UnsignedInt
  userId    Int      @map("user_id") @db.UnsignedInt
  movieId   Int      @map("movie_id") @db.UnsignedInt
  value     Int      @db.UnsignedTinyInt
  createdAt DateTime @default(now()) @map("created_at") @db.DateTime(0)
  movie     Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade, map: "movie_star.movie_id,movie.id")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade, map: "movie_star.user_id,user.id")

  @@unique([userId, movieId], map: "UNIQUE INDEX (user_id,movie_id)")
  @@index([movieId], map: "movie_star.movie_id,movie.id")
  @@map("movie_star")
}

model MovieStatistic {
  id           Int      @id @default(autoincrement()) @db.UnsignedInt
  movieId      Int      @map("movie_id") @db.UnsignedInt
  viewCount    Int      @map("view_count") @db.UnsignedInt
  commentCount Int      @map("comment_count") @db.UnsignedInt
  likeCount    Int      @map("like_count") @db.UnsignedInt
  starAverage  Float    @map("star_average")
  createdAt    DateTime @default(now()) @map("created_at") @db.DateTime(0)
  movie        Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade, map: "movie_statistic.movie_id,movie.id")

  @@index([movieId], map: "movie_statistic.movie_id,movie.id")
  @@map("movie_statistic")
}

model Report {
  id                 Int          @id @default(autoincrement()) @db.UnsignedInt
  userId             Int          @map("user_id") @db.UnsignedInt
  type               Int          @db.UnsignedTinyInt
  targetId           Int          @map("target_id") @db.UnsignedInt
  isDeleted          Boolean      @default(dbgenerated("(b'0')")) @map("is_deleted") @db.Bit(1)
  createdAt          DateTime     @default(now()) @map("created_at") @db.DateTime(0)
  targetMovie        Movie        @relation(fields: [targetId], references: [id], onDelete: Cascade, onUpdate: Cascade, map: "report.target_id,movie.id")
  targetMovieComment MovieComment @relation(fields: [targetId], references: [id], onDelete: Cascade, onUpdate: Cascade, map: "report.target_id,movie_comment.id")
  targetUser         User         @relation(fields: [targetId], references: [id], onDelete: Cascade, onUpdate: Cascade, map: "report.target_id,user.id")
  user               User         @relation("report.user_id,user.id", fields: [userId], references: [id], onUpdate: Restrict, map: "report.user_id,user.id")

  @@index([targetId], map: "report.target_id,user.id")
  @@index([userId], map: "report.user_id,user.id")
  @@map("report")
}

model User {
  id              Int            @id @default(autoincrement()) @db.UnsignedInt
  email           String         @unique(map: "email") @db.VarChar(64)
  password        String         @db.VarChar(128)
  handle          String         @unique(map: "handle") @db.VarChar(32)
  name            String         @db.VarChar(64)
  description     String?        @db.VarChar(1024)
  profileMediaId  Int?           @unique(map: "profile_image_id") @map("profile_media_id") @db.UnsignedInt
  bannerMediaId   Int?           @unique(map: "banner_image_id") @map("banner_media_id") @db.UnsignedInt
  verificationKey String?        @unique(map: "verification_key") @map("verification_key") @db.VarChar(40)
  isVerified      Boolean        @default(dbgenerated("(b'0')")) @map("is_verified") @db.Bit(1)
  isDeleted       Boolean        @default(dbgenerated("(b'0')")) @map("is_deleted") @db.Bit(1)
  createdAt       DateTime       @default(now()) @map("created_at") @db.DateTime(0)
  movies          Movie[]
  movieComments   MovieComment[]
  movieLikes      MovieLike[]
  movieStars      MovieStar[]
  targetedReports Report[]
  reports         Report[]       @relation("report.user_id,user.id")
  bannerMedia     Media?         @relation("user.banner_media_id,media.id", fields: [bannerMediaId], references: [id], onDelete: Restrict, onUpdate: Restrict, map: "user.banner_media_id,media.id")
  profileMedia    Media?         @relation("user.profile_media_id,media.id", fields: [profileMediaId], references: [id], onDelete: Restrict, onUpdate: Restrict, map: "user.profile_media_id,media.id")
  userHistories   UserHistory[]

  @@map("user")
}

model UserHistory {
  id        Int      @id @default(autoincrement()) @db.UnsignedInt
  userId    Int      @map("user_id") @db.UnsignedInt
  movieId   Int      @map("movie_id") @db.UnsignedInt
  isDeleted Boolean  @default(dbgenerated("(b'0')")) @map("is_deleted") @db.Bit(1)
  createdAt DateTime @default(now()) @map("created_at") @db.DateTime(0)
  movie     Movie    @relation(fields: [movieId], references: [id], onUpdate: Restrict, map: "user_history.movie_id,movie.id")
  user      User     @relation(fields: [userId], references: [id], onUpdate: Restrict, map: "user_history.user_id,user.id")

  @@index([movieId], map: "user_history.movie_id,movie.id")
  @@index([userId], map: "user_history.user_id,user.id")
  @@map("user_history")
}
